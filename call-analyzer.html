<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>è¯å•åˆ†æå·¥å…·</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px}
    .header{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:30px;text-align:center;border-radius:10px;margin-bottom:20px}
    .header h1{margin:0}
    .card{background:white;border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    .drop-zone{border:2px dashed #ddd;border-radius:10px;padding:50px;text-align:center;cursor:pointer;margin-bottom:15px}
    .drop-zone:hover{border-color:#667eea;background:rgba(102,126,234,0.05)}
    .btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;margin-right:10px}
    .btn-primary{background:#667eea;color:white}
    .btn-secondary{background:#f0f0f0;color:#666}
    .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:20px}
    .stat-card{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:10px;text-align:center}
    .stat-card.green{background:linear-gradient(135deg,#11998e,#38ef7d)}
    .stat-card.orange{background:linear-gradient(135deg,#f093fb,#f5576c)}
    .stat-card.blue{background:linear-gradient(135deg,#4facfe,#00f2fe)}
    .stat-card .value{font-size:24px;font-weight:bold}
    .stat-card .label{font-size:12px;opacity:0.9}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eee}
    th{background:#f8f9fa;color:#666}
    .hidden{display:none}
    .file-list{margin:10px 0}
    .file-item{padding:8px;background:#f8f9fa;border-radius:5px5px}
   ;margin-bottom: .progress-bar{height:8px;background:#eee;border-radius:4px;margin:10px 0}
    .progress-fill{height:100%;border-radius:4px}
    .progress-fill.blue{background:#4facfe}
    .progress-fill.green{background:#38ef7d}
  </style>
</head>
<body>
  <div class="header">
    <h1>è¯å•åˆ†æå·¥å…·</h1>
    <p>ä»…æ”¯æŒ CSV æ ¼å¼</p>
  </div>
  
  <div class="card" id="importCard">
    <h3>å¯¼å…¥è¯å•</h3>
    <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
      <p>ğŸ“‚ ç‚¹å‡»é€‰æ‹© CSV æ–‡ä»¶</p>
      <p style="color:#888">ä»…æ”¯æŒ CSV æ ¼å¼</p>
    </div>
    <input type="file" id="fileInput" multiple accept=".csv" style="display:none" onchange="handleFiles()">
    <div id="fileList" class="file-list"></div>
    <button class="btn btn-primary" onclick="analyze()">å¼€å§‹åˆ†æ</button>
    <button class="btn btn-secondary" onclick="clearFiles()">æ¸…é™¤</button>
  </div>

  <div class="card hidden" id="loadingCard">
    <p id="loadingText" style="text-align:center;padding:30px">æ­£åœ¨è§£æ...</p>
  </div>

  <div id="resultArea" class="hidden">
    <div class="stats-grid">
      <div class="stat-card"><div class="value" id="totalCalls">-</div><div class="label">æ€»é€šè¯æ¬¡æ•°</div></div>
      <div class="stat-card green"><div class="value" id="totalDuration">-</div><div class="label">æ€»é€šè¯æ—¶é•¿</div></div>
      <div class="stat-card orange"><div class="value" id="avgDuration">-</div><div class="label">å¹³å‡æ—¶é•¿</div></div>
      <div class="stat-card blue"><div class="value" id="totalContacts">-</div><div class="label">è”ç³»äººæ•°</div></div>
    </div>

    <div class="card">
      <h3>ä¸»å«/è¢«å«åˆ†å¸ƒ</h3>
      <p>ä¸»å«: <span id="outgoingText">0 (0%)</span></p>
      <div class="progress-bar"><div class="progress-fill blue" id="outgoingBar" style="width:0%"></div></div>
      <p>è¢«å«: <span id="incomingText">0 (0%)</span></p>
      <div class="progress-bar"><div class="progress-fill green" id="incomingBar" style="width:0%"></div></div>
    </div>

    <div class="card">
      <h3>è”ç³»äºº TOP20</h3>
      <table>
        <thead><tr><th>æ’å</th><th>å·ç </th><th>æ¬¡æ•°</th><th>æ—¶é•¿</th><th>æœ€åé€šè¯</th></tr></thead>
        <tbody id="contactTable"></tbody>
      </table>
    </div>
  </div>

  <script src="analyzer.js"></script>
  <script>
    var selectedFiles = [];
    var analyzer = new CallAnalyzer();

    function handleFiles() {
      var input = document.getElementById('fileInput');
      if (input.files.length > 0) {
        selectedFiles = Array.from(input.files);
        var html = '';
        for (var i = 0; i < selectedFiles.length; i++) {
          html += '<div class="file-item">' + selectedFiles[i].name + '</div>';
        }
        document.getElementById('fileList').innerHTML = html;
      }
    }

    function clearFiles() {
      selectedFiles = [];
      document.getElementById('fileInput').value = '';
      document.getElementById('fileList').innerHTML = '';
      document.getElementById('resultArea').className = 'hidden';
    }

    function analyze() {
      if (selectedFiles.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
        return;
      }

      document.getElementById('importCard').className = 'hidden';
      document.getElementById('loadingCard').className = 'card';
      
      analyzer.calls = [];
      
      var reader = new FileReader();
      reader.onload = function(e) {
        try {
          var content = e.target.result;
          var calls = analyzer.parseCSV(content);
          for (var i = 0; i < calls.length; i++) {
            analyzer.calls.push(calls[i]);
          }
          
          // æ˜¾ç¤ºç»“æœ
          var stats = analyzer.getStatistics();
          var contacts = analyzer.getContactAnalysis();
          
          document.getElementById('totalCalls').textContent = stats.totalCalls;
          document.getElementById('totalDuration').textContent = stats.totalDuration;
          document.getElementById('avgDuration').textContent = stats.avgDuration;
          document.getElementById('totalContacts').textContent = contacts.totalContacts;
          
          var incoming = stats.callTypes.incoming;
          var outgoing = stats.callTypes.outgoing;
          var total = incoming + outgoing;
          document.getElementById('incomingText').textContent = incoming + ' (' + (total ? Math.round(incoming/total*100) : 0) + '%)';
          document.getElementById('outgoingText').textContent = outgoing + ' (' + (total ? Math.round(outgoing/total*100) : 0) + '%)';
          document.getElementById('incomingBar').style.width = total ? incoming/total*100 + '%' : '0%';
          document.getElementById('outgoingBar').style.width = total ? outgoing/total*100 + '%' : '0%';
          
          var html = '';
          var topContacts = contacts.topContacts.slice(0, 20);
          for (var i = 0; i < topContacts.length; i++) {
            var c = topContacts[i];
            html += '<tr><td>' + (i+1) + '</td><td>' + c.phone + '</td><td>' + c.count + '</td><td>' + c.durationStr + '</td><td>' + (c.lastCall ? c.lastCall.split(' ')[0] : '-') + '</td></tr>';
          }
          document.getElementById('contactTable').innerHTML = html || '<tr><td colspan="5" style="text-align:center">æš‚æ— æ•°æ®</td></tr>';
          
          document.getElementById('loadingCard').className = 'hidden';
          document.getElementById('resultArea').className = '';
          
          alert('åˆ†æå®Œæˆï¼å…± ' + analyzer.calls.length + ' æ¡è®°å½•');
        } catch (err) {
          document.getElementById('loadingText').textContent = 'è§£æå¤±è´¥: ' + err.message;
        }
      };
      
      reader.onerror = function() {
        document.getElementById('loadingText').textContent = 'è¯»å–æ–‡ä»¶å¤±è´¥';
      };
      
      // åªè¯»å–ç¬¬ä¸€ä¸ªæ–‡ä»¶
      reader.readAsText(selectedFiles[0]);
    }
  </script>
</body>
</html>
